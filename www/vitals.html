<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Verity - System Vitals</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            min-height: 100vh;
            background: #0a0a0a;
            color: #e5e5e5;
            padding: 2rem;
        }
        .header {
            max-width: 720px;
            margin: 0 auto 2rem;
            display: flex;
            align-items: baseline;
            justify-content: space-between;
        }
        .header h1 { font-size: 1.5rem; font-weight: 600; letter-spacing: -0.02em; }
        .header a {
            color: #737373;
            font-size: 0.875rem;
            text-decoration: none;
            transition: color 0.15s;
        }
        .header a:hover { color: #e5e5e5; }
        .grid {
            max-width: 720px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .card {
            background: #141414;
            border: 1px solid #262626;
            border-radius: 8px;
            padding: 1.25rem;
        }
        .card .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #737373;
            margin-bottom: 0.5rem;
        }
        .card .value {
            font-size: 1rem;
            font-weight: 500;
            word-break: break-word;
        }
        .card .sub {
            font-size: 0.75rem;
            color: #525252;
            margin-top: 0.25rem;
        }
        .status {
            max-width: 720px;
            margin: 1.5rem auto 0;
            font-size: 0.75rem;
            color: #525252;
            text-align: right;
        }
        .error {
            max-width: 720px;
            margin: 2rem auto;
            text-align: center;
            color: #ef4444;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>System Vitals</h1>
        <a href="/">&larr; Home</a>
    </div>
    <div id="grid" class="grid"></div>
    <div id="status" class="status"></div>
    <div id="error" class="error" hidden></div>

    <script>
        const grid = document.getElementById("grid");
        const status = document.getElementById("status");
        const errorEl = document.getElementById("error");

        function fmt(bytes) {
            if (bytes >= 1073741824) return (bytes / 1073741824).toFixed(1) + " GB";
            if (bytes >= 1048576) return (bytes / 1048576).toFixed(1) + " MB";
            return (bytes / 1024).toFixed(1) + " KB";
        }

        function fmtUptime(sec) {
            const d = Math.floor(sec / 86400);
            const h = Math.floor((sec % 86400) / 3600);
            const m = Math.floor((sec % 3600) / 60);
            const parts = [];
            if (d) parts.push(d + "d");
            if (h) parts.push(h + "h");
            parts.push(m + "m");
            return parts.join(" ");
        }

        function card(label, value, sub) {
            let html = '<div class="card"><div class="label">' + label + '</div><div class="value">' + value + "</div>";
            if (sub) html += '<div class="sub">' + sub + "</div>";
            return html + "</div>";
        }

        async function refresh() {
            try {
                const res = await fetch("/api/vitals");
                if (!res.ok) throw new Error("HTTP " + res.status);
                const d = await res.json();
                errorEl.hidden = true;

                grid.innerHTML =
                    card("Hostname", d.hostname) +
                    card("IP Address", d.ip) +
                    card("Platform", d.platform + " / " + d.arch) +
                    card("Uptime", fmtUptime(d.uptime)) +
                    card("CPU", d.cpu.model, d.cpu.cores + " cores") +
                    card("Memory Used", fmt(d.memory.used), fmt(d.memory.used) + " / " + fmt(d.memory.total)) +
                    card("Memory Free", fmt(d.memory.free)) +
                    card("Load Average", d.load.map(function (v) { return v.toFixed(2); }).join("  "), "1 / 5 / 15 min");

                status.textContent = "Updated " + new Date().toLocaleTimeString();
            } catch (e) {
                errorEl.textContent = "Failed to fetch vitals: " + e.message;
                errorEl.hidden = false;
            }
        }

        refresh();
        setInterval(refresh, 5000);
    </script>
</body>
</html>
