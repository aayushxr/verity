# Verity — kernel hardening

# Prevent kernel pointer leaks
kernel.kptr_restrict = 2

# Restrict access to kernel logs
kernel.dmesg_restrict = 1

# Disable kernel module loading after boot
kernel.modules_disabled = 1

# Restrict ptrace to admin only
kernel.yama.ptrace_scope = 2

# Disable kexec (prevents runtime kernel replacement)
kernel.kexec_load_disabled = 1

# Enable ASLR (full randomization)
kernel.randomize_va_space = 2

# Network hardening — reverse-path filtering (strict mode)
net.ipv4.conf.all.rp_filter = 1
net.ipv4.conf.default.rp_filter = 1

# Disable source routing
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.default.accept_source_route = 0

# Disable ICMP redirects (prevent MitM route injection)
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.default.accept_redirects = 0
net.ipv4.conf.all.secure_redirects = 0
net.ipv4.conf.default.secure_redirects = 0
net.ipv6.conf.all.accept_redirects = 0
net.ipv6.conf.default.accept_redirects = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.default.send_redirects = 0

# Ignore ICMP ping requests
net.ipv4.icmp_echo_ignore_all = 1

# Enable SYN cookies for SYN flood protection
net.ipv4.tcp_syncookies = 1

# Disable IPv6
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1

# File system hardening
fs.protected_hardlinks = 1
fs.protected_symlinks = 1
fs.suid_dumpable = 0

# Restrict core dumps
kernel.core_uses_pid = 1
